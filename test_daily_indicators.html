<!DOCTYPE html>
<html>
<head>
    <title>每日指标测试</title>
</head>
<body>
    <h1>每日指标测试</h1>
    <div id="results"></div>
    
    <script>
    async function testDailyIndicators() {
        try {
            // 测试daily_basic API
            const dailyResponse = await fetch('/api/stock/000001.SZ/daily_basic');
            const dailyResult = await dailyResponse.json();
            
            // 测试realtime API
            const realtimeResponse = await fetch('/api/stock/000001.SZ/realtime');
            const realtimeResult = await realtimeResponse.json();
            
            const results = document.getElementById('results');
            results.innerHTML = `
                <h2>Daily Basic API结果:</h2>
                <p>PE: ${dailyResult.data.pe}</p>
                <p>PE TTM: ${dailyResult.data.pe_ttm}</p>
                <p>DV Ratio: ${dailyResult.data.dv_ratio}</p>
                <p>DV TTM: ${dailyResult.data.dv_ttm}</p>
                
                <h2>Realtime API结果:</h2>
                <p>Net MF Amount: ${realtimeResult.net_mf_amount}</p>
                
                <h2>格式化后的结果:</h2>
                <p>PE (格式化): ${formatValue(dailyResult.data.pe, 'ratio')}</p>
                <p>DV Ratio (格式化): ${formatValue(dailyResult.data.dv_ratio, 'percentage')}</p>
                <p>Net MF Amount (格式化): ${formatValue(realtimeResult.net_mf_amount, 'large_number')}</p>
            `;
        } catch (error) {
            document.getElementById('results').innerHTML = `错误: ${error.message}`;
        }
    }
    
    function formatValue(value, type = 'number') {
        if (value === null || value === undefined || value === '') {
            return '--';
        }
        
        const num = parseFloat(value);
        if (isNaN(num)) return value;
        
        switch (type) {
            case 'currency':
                return `¥${num.toFixed(2)}`;
            case 'percentage':
                return `${num.toFixed(2)}%`;
            case 'large_number':
                if (num >= 100000000) {
                    return `${(num / 100000000).toFixed(2)}亿`;
                } else if (num >= 10000) {
                    return `${(num / 10000).toFixed(2)}万`;
                }
                return num.toFixed(2);
            case 'ratio':
                return num.toFixed(2);
            default:
                return num.toFixed(2);
        }
    }
    
    // 页面加载后执行测试
    window.onload = testDailyIndicators;
    </script>
</body>
</html>